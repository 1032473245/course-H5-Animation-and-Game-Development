require.async(["wkcommon:widget/lib/tangram/base/base.js","wkcommon:widget/lib/fis/data/data.js","wkview:widget/ui/view/down_doc/down_doc.js","wkcommon:widget/ui/js_core/login/login.js","wkcommon:widget/ui/js_core/log/log.js","wkcommon:widget/ui/lib/jquery/jquery.js","wkcommon:widget/ui/lib/store/store.js","wkview:widget/ui/view/down_doc/down_org_vip.js","wkview:widget/ui/view/down_doc/down_doc.js"],function(e,o,i,t,n,d,a,c,s){var r;e.dom.ready(function(){d(window).bind("beforeunload",function(){n.xsend(1,100038,{duration:(new Date).getTime()-PLAYER_LOAD_START});for(var e=(new Date).getTime();(new Date).getTime()-e<1e3;);}),d(".nav-wrap").delegate("a","mousedown",function(){n.xsend(1,100023,{href:encodeURIComponent(d(this).attr("href"))})});d.ajax({url:"/customer/interface/getuserdownloadticket",type:"get",cache:!1,success:function(e){if(0===e.status.code){var o=0,i=+e.data.isvip;e.data.edu_vip_data&&(o=+e.data.edu_vip_data.is_edu_vip),r=i||o}}}),e.ajax.get("/user/interface/getuserinfo?t="+Math.round((new Date).getTime()/6e3),function(o,i){var t,n=i?e.json.parse(i):i,a="string"==typeof n?"":n.data.vipinfo,c=e.dom.q("ic",e.dom.q("toolbar-fsm-btn")[0],"span");setTimeout(function(){var o=e.dom.g("tip-notice-new"),i=e.dom.g("vip-msg");a&&(e.dom.removeClass(i,"vip-msg-hide"),e.dom.addClass(o,"doc-tag"),d("tip-notice-new").remove(),t=e.dom.g("tip-notice")),t&&a&&(e.dom.removeClass(c,"ic-joinvip"),e.dom.removeClass(c,"vip-icon"),e.dom.removeClass(c,"ic"),d("#tip-notice-new").remove(),t.innerHTML='10\u4e07\u7bc7\u6587\u6863<i style="font-style: normal; color:#db5b5a;">VIP\u4e13\u4eab\u514d\u8d39\u4e2d\uff01</i>',e.dom.addClass(t,"a-new"),e.dom.setAttr(t,"href","/user/browse/newvipfreedoczone"),e.dom.addClass(t,"log-xsend"),e.dom.setAttr(t,"data-logxsend","[1, 100833]"))},1e3)});var a=o.get("WkInfo"),l=a.DocInfo,f=t.login;if(n.xsend(1,100604),e.cookie.get("BAIDU_DOC_NACT")){if(!e.g("login")){var w=e.cookie.get("BAIDU_DOC_NACT");switch(w){case"download":if(a.UserInfo.isLimit)f.notifyToVerificationMail();else{var m=i.downDocCreate();m.start()}break;case"upload":location.href="/new?fr=login";break;case"addToAlbum":}}e.cookie.remove("BAIDU_DOC_NACT")}var p=location.search;p.indexOf("isbtn")>-1&&(s=s.downDoc,d.ajax({url:"/orgvip/interface/caniuse",cache:!1,async:!1,type:"get",data:{doc_id:a.DocInfo.docId,dowmloadTime:(new Date).getTime()}}).done(function(o){o&&void 0!==o.status.code&&11===+o.data.vip_type?c.init({WkInfo:a,docSize:(a.DocInfo.size/1024+"").replace(/^(\d+\.\d)\d+$/,"$1"),downDoc:s,caniuse:o}):f.verlogin(function(){e.lang.eventCenter.dispatchEvent("download.doc")},null,null,{actionName:"download",fromMod:"download"},!1)}).fail(function(){f.verlogin(function(){e.lang.eventCenter.dispatchEvent("download.doc")},null,null,{actionName:"download",fromMod:"download"},!1)})),function(){function o(){var o,i=0,t=(new Date).getTime(),d={docId:a.DocInfo.docId,docType:a.DocInfo.docType,cid1:a.DocInfo.cid1,cid2:a.DocInfo.cid2,cid3:a.DocInfo.cid3,cid4:a.DocInfo.cid4,totalPageNum:a.DocInfo.totalPageNum,pageviewtimelength:0};e.on(window,"load",function(){date=new Date,t=date.getTime()}),e.on(window,"focus",function(){date=new Date,t=date.getTime()}),e.on(window,"blur",function(){date=new Date,o=date.getTime(),i+=o-t}),e.on(window,"unload",function(){date=new Date,o=date.getTime(),t=t||o,i+=o-t,d.pageviewtimelength=i,d.t=(new Date).getTime(),d.readerVersion=a.DocInfo.readerVersion,d.ply=a.DocInfo.readerType||"html",n.send("view","pageviewtime",d);for(var e=new Date;new Date-e<250;);})}o()}(),n.send("view","viewload",{cid1:l.cid1,cid2:l.cid2,cid3:l.cid3,cid4:l.cid4,doctype:l.docType,copyright:a.PageInfo.copyright,relatedoc:l.relateDoc,otherlikedoc:l.otherLikeDoc,relatealblum:l.relateAlblum,sameseriesdoc:l.sameSeriesDoc,flag:l.flag,ply:l.readerType})}),e.dom.ready(function(){var i=o.get("WkInfo"),t=i.PageInfo.isLogin,c=(+i.DocInfo.is_edu_doc,+i.DocInfo.isPaymentDoc,+i.DocInfo.docTicket,+i.DocInfo.hangyebaogao_customized),s=i.DocInfo.org_engName;if(1==c&&(n.xsend(1,100764),"chinairr"==s?n.xsend(1,100793):(s="ibaogao")&&n.xsend(1,100794)),t){var l=e.cookie.get("wk_user_view");l&&e.cookie.set("wk_user_view","",{path:"/",expires:36e5});var f=(new Date).getTime(),w=i.DocInfo.title,m=i.DocInfo.docId,p=i.DocInfo.docType,g=p+":"+m+":"+w+":"+f,u=a.get("wk_user_view")+"",v=a.get("wk_user_view");if(v=v?v.split("###"):[],-1!=u.indexOf(m)||-1!=u.indexOf("undefined"))for(var D=0;D<v.length;D++)if(-1!=(v[D]+"").indexOf(m)||-1!=(v[D]+"").indexOf("undefined")){v.splice(D,1);break}v.push(g),v.length>12&&v.shift(),a.set("wk_user_view",v.join("###"))}d.ajax({type:"get",async:!0,cache:!1,url:"/user/interface/getvipfreedoc?doc_id="+i.DocInfo.docId,success:function(e){var n=!1,a=d("#tip-notice-new"),c=(a.parent(),d(".new-ico-wkmember-free-doc")),s=i.DocInfo.docTicket||0,l=+i.DocInfo.isPaymentDoc||0,f=+i.DocInfo.ispaied||0,w=+i.DocInfo.hangyebaogao_customized||0;e&&0===e.status.code&&(e.data.is_vip_free_doc&&(n=!0,n&&(c.show(),d(window).scroll(function(){var e=c.parent(),o=0===d("body").scrollTop()&&d("html").scrollTop()?"html":"body";c.css(d(o).scrollTop()>280&&d(o).scrollTop()<e.height()+50?{position:"fixed",left:e.offset().left-3,top:80}:{position:"absolute",top:20,left:-3})}),d(window).resize(function(){var e=c.parent(),o=0===d("body").scrollTop()&&d("html").scrollTop()?"html":"body";c.css(d(o).scrollTop()>280&&d(o).scrollTop()<e.height()+50?{position:"fixed",left:e.offset().left-3,top:80}:{position:"absolute",top:20,left:-3})}),setTimeout(function(){if(a=d("#tip-notice-new"),a&&!r&&0===d("#ppt-wrap").length){if(a.addClass("btn-wkvip"),a.html('<div><p><span class="iconfont">&#xe64e;</span>VIP\u4e13\u4eab</p>0\u4e0b\u8f7d\u5238 \u4e0b\u8f7d</div>'),t){var e=+o.get("isDialogCashier");if(0!==+i.DocInfo.vip_type&&i.DocInfo.vip_type||1!==e){var n="/cashier/browse/dispatch?dqStatCode=31_8_171_174&from_doc="+i.DocInfo.docId;a.attr("href",n)}else;}a.css({visibility:"inherit"})}},800)),o.set("VipFreeDoc",n)),e.data.is_vip_free_doc||setTimeout(function(){r||(a=d("#tip-notice-new"),s||a.html("\u52a0\u5165VIP,\u83b7\u53d6\u66f4\u591a\u7279\u6743"),a.css({visibility:"inherit"}))},1e3),f&&w&&l&&setTimeout(function(){var e=d("#tip-notice-new");e.hide()},1200))}})})});